import{E as P,e as U,f as B,a as F,g as H,h as O}from"./element-plus-a045e21a.js";import{_ as W}from"./error.vue_vue_type_script_setup_true_lang-be3a5616.js";import{_ as X}from"./markdownEditor-b1205fb3.js";import{d as I}from"./dayjs-21666597.js";import{h as A,u as G,a as J}from"./index-e009af10.js";import{r as g,F as D,o as r,c as f,a as l,V as h,W as x,b as a,u as t,X as T,R as w,bE as R,P as S,ae as q,S as K,a8 as Q,B as Y}from"./@vue-c4263cf4.js";import{a as Z,b as ee,c as te}from"./@icon-park-0cf5c685.js";import{u as oe}from"./useSoft-d01f0a95.js";import{u as ne}from"./vue-router-42f2e400.js";import{_ as se}from"./_plugin-vue_export-helper-c27b6911.js";import"./lodash-es-86f8b411.js";import"./async-validator-dee29e8b.js";import"./@vueuse-f6356746.js";import"./@element-plus-fb556ceb.js";import"./@sxzz-c75af06c.js";import"./@ctrl-f8748455.js";import"./@kangc-2d97e763.js";import"./vue-75335097.js";import"./useUpload-9088fbb8.js";import"./pinia-4db09d7f.js";import"./vue-demi-71ba0ef2.js";/* empty css                    */import"./axios-4a70c6fc.js";import"./prismjs-c9df2a09.js";import"./highlight.js-4e111ff9.js";const j=c=>{const n=g([]),s=g({});return{findAll:async()=>{n.value=await A.request({url:`comment/${c}`})},add:async e=>{var m;const o=await A.request({method:"POST",url:`comment/${c}`,data:e});s.value.content="",e.commentId?(m=n.value.find(v=>v.id==e.commentId))==null||m.replys.push(o):n.value.push(o)},del:async e=>{await P.confirm("确定删除吗？"),await A.request({url:`comment/${c}/${e}`,method:"DELETE"});const o=n.value.findIndex(m=>m.id==e);n.value.splice(o,1)},collections:n,model:s}},le={class:"mb-3 border rounded-md bg-white opacity-90"},ae={class:"flex justify-between items-baseline p-3 border-b"},ie={class:"flex gap-2"},me=["src"],ce={class:"flex flex-col text-xs"},re={class:"flex items-center gap-2"},de={class:"flex items-center"},_e={key:0,class:"flex cursor-pointer"},ue={class:"p-3"},pe={key:0,class:"p-3"},L=D({__name:"commentItem",props:{comment:{}},emits:["del","add"],setup(c,{emit:n}){const{comment:s}=c,{authorize:d}=G(),{model:i}=j(s.softId);i.value.commentId=s.commentId||s.id;const _=g(!1);return(e,o)=>{const m=Z,v=ee,$=te,y=U,u=B;return r(),f("section",le,[l("div",ae,[l("div",ie,[l("img",{src:e.comment.user.avatar,class:"w-8 h-8 rounded-full"},null,8,me),l("div",ce,[h(x(e.comment.user.nickname)+" #"+x(e.comment.id)+" ",1),l("div",re,[l("div",de,[a(m,{theme:"outline",size:"12",fill:"#333"}),h(" "+x(t(I)(e.comment.createAt).fromNow()),1)]),l("div",{class:"flex items-center cursor-pointer",onClick:o[0]||(o[0]=p=>_.value=!t(_))},[a(v,{theme:"outline",size:"12",fill:"#333"}),h(" 回复 ")])])])]),t(d)(e.comment.id)?(r(),f("div",_e,[a($,{theme:"outline",size:"12",fill:"#333",onClick:o[1]||(o[1]=p=>e.$emit("del",e.comment.id))})])):T("",!0)]),l("div",ue,x(e.comment.content),1),t(_)?(r(),f("div",pe,[a(y,{modelValue:t(i).content,"onUpdate:modelValue":o[2]||(o[2]=p=>t(i).content=p),type:"textarea",size:"default",clearable:""},null,8,["modelValue"]),a(u,{type:"primary",size:"small",onClick:o[3]||(o[3]=p=>e.$emit("add",t(i)))},{default:w(()=>[h("回复")]),_:1})])):T("",!0)])}}}),k="interval_exec_time",E=J();let z=0;const V=g(0),fe=(c,n)=>{const s=()=>{z=setInterval(()=>{V.value=I(E.get(k)).add(c,"second").diff(I(),"second"),V.value<=0&&(clearInterval(z),z=void 0)},50)},d=async(...i)=>{if(E.get(k))return F({message:`请${V.value}秒后操作`,type:"error"});await n.apply(null,i),E.set(k,I(),c),s()};return E.get(k)&&s(),{time:V,exec:d}},ve={class:"ml-5"},ye={class:"py-3"},he=D({__name:"commentList",props:{sid:{}},async setup(c){let n,s;const{sid:d}=c,{collections:i,findAll:_,model:e,add:o,del:m}=j(d);[n,s]=R(()=>_()),await n,s();const{exec:v,time:$}=fe(20,y=>o(y));return(y,u)=>{const p=X,C=W,M=B;return r(),f("main",null,[l("section",null,[(r(!0),f(S,null,q(t(i),b=>(r(),f("div",{class:"",key:b.id},[a(L,{comment:b,onDel:t(m),onAdd:t(o)},null,8,["comment","onDel","onAdd"]),l("div",ve,[(r(!0),f(S,null,q(b.replys,N=>(r(),K(L,{key:N.id,comment:N,onDel:t(m),onAdd:t(o)},null,8,["comment","onDel","onAdd"]))),128))])]))),128))]),l("section",ye,[a(p,{modelValue:t(e).content,"onUpdate:modelValue":u[0]||(u[0]=b=>t(e).content=b)},null,8,["modelValue"]),a(C,{name:"content"}),a(M,{type:"primary",size:"default",onClick:u[1]||(u[1]=b=>t(v)(t(e))),class:"mt-3"},{default:w(()=>[h(" 保存提交 ")]),_:1})])])}}}),be={class:""},we={class:"bg-white p-5 rounded-md"},xe={class:"flex justify-between items-center font-bold text-xl opacity-80"},ge={class:""},$e={class:""},ke=D({__name:"show",async setup(c){let n,s;const{find:d,model:i}=oe(),_=ne();i.value=([n,s]=R(()=>d(+_.params.id)),n=await n,s(),n);const e=g("comment");return(o,m)=>{const v=B,$=Q("v-md-preview"),y=H,u=he,p=O;return r(),f("main",be,[l("section",we,[l("h1",xe,[h(x(t(i).title)+" ",1),l("div",ge,[a(v,{type:"primary",size:"default",onClick:m[0]||(m[0]=()=>{})},{default:w(()=>[h("下载软件")]),_:1})])])]),a(p,{modelValue:t(e),"onUpdate:modelValue":m[1]||(m[1]=C=>Y(e)?e.value=C:null),type:"card","tab-position":"top",class:"bg-white rounded-md opacity-90 px-5 mt-5 pt-5"},{default:w(()=>[a(y,{label:"软件介绍 ",name:"content"},{default:w(()=>[l("section",$e,[a($,{text:t(i).content},null,8,["text"])])]),_:1}),a(y,{label:"问题讨论 ",name:"comment"},{default:w(()=>[a(u,{sid:t(i).id},null,8,["sid"])]),_:1})]),_:1},8,["modelValue"])])}}});const Ke=se(ke,[["__scopeId","data-v-581de9c2"]]);export{Ke as default};
